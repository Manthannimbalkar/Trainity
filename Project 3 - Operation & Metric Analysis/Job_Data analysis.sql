use Trainity;
select * from job_data;

insert into job_data values
('2020-12-01', 26, 1001, 'skip', 'French', 120, 'D'),
('2020-12-01', 26, 1008, 'decision', 'German', 150, 'A'),
('2020-12-02', 27, 1002, 'transfer', 'English', 70, 'B'),
('2020-12-03', 11, 1003, 'decison', 'Arabic', 50, 'C'),
('2020-12-03', 20, 1004, 'transfer', 'Hindi', 100, 'D'),
('2020-12-04', 23, 1006, 'skip', 'German', 10, 'A'),
('2020-12-05', 26, 1005, 'transfer', 'Persian', 75, 'B'),
('2020-12-06', 11, 1007, 'decison', 'Italian', 60, 'C'),
('2020-12-07', 22, 1007, 'desicion', 'Arabic', 50, 'D'),
('2020-12-08', 23, 1008, 'skip', 'Hindi', 105, 'A'),
('2020-12-09', 24, 1009, 'transfer', 'German', 170, 'B'),
('2020-12-10', 25, 1010, 'skip', 'English', 60, 'C'),
('2020-12-11', 26, 1001, 'desicion', 'Italian', 60, 'D'),
('2020-12-12', 27, 1002, 'transfer', 'French', 125, 'C'),
('2020-12-13', 28, 1003, 'skip', 'Arabic', 20, 'B'),
('2020-12-14', 29, 1004, 'transfer', 'Persian', 92, 'A'),
('2020-12-15', 26, 1005, 'desicion', 'German', 69, 'D'),
('2020-12-16', 27, 1006, 'transfer', 'Italian', 101, 'C'),
('2020-12-17', 28, 1007, 'skip', 'French', 24, 'B'),
('2020-12-18', 29, 1008, 'decision', 'English', 68, 'A'),
('2020-12-15', 30, 1009, 'transfer', 'Hindi', 17, 'D'),
('2020-12-16', 31, 1010, 'decision', 'Marathi', 145, 'C'),
('2020-12-17', 32, 1001, 'skip', 'German', 24, 'B'),
('2020-12-18', 33, 1002, 'decision', 'French', 63, 'A'),
('2020-12-19', 34, 1003, 'transfer', 'Marathi', 144, 'D'),
('2020-12-20', 35, 1004, 'decision', 'French', 86, 'C'),
('2020-12-21', 36, 1005, 'skip', 'Arabic', 27, 'B'),
('2020-12-22', 37, 1006, 'decision', 'Italian', 66, 'A'), 
('2020-12-23', 38, 1007, 'transfer', 'Persian', 77, 'A'),
('2020-12-24', 39, 1008, 'transfer', 'Marathi', 88, 'A'),
('2020-12-25', 40, 1009, 'decision', 'Marathi', 189, 'D'),
('2020-12-25', 11, 1010, 'decision', 'German', 200, 'C'),
('2020-12-25', 20, 1001, 'skip', 'French', 26, 'B'),
('2020-12-25', 22, 1002, 'decision', 'English', 33, 'A'), 
('2020-12-23', 21, 1003, 'transfer', 'Italian', 79, 'A'),
('2020-12-25', 23, 1004, 'transfer', 'Hindi', 98, 'B'),
('2020-12-25', 21, 1003, 'transfer', 'Italian', 79, 'A'),
('2020-12-25', 21, 1003, 'transfer', 'Arabic', 91, 'C'),
('2020-12-26', 27, 1005, 'decision', 'Marathi', 107, 'A'),
('2020-12-26', 28, 1006, 'decision', 'German', 115, 'B'),
('2020-12-26', 29, 1007, 'skip', 'French', 34, 'C'),
('2020-12-26', 30, 1002, 'decision', 'English', 49, 'D'), 
('2020-12-26', 31, 1008, 'transfer', 'Italian', 85, 'D'),
('2020-12-26', 32, 1009, 'transfer', 'Hindi', 96, 'C'),
('2020-12-27', 33, 1010, 'skip', 'Persian', 68, 'C'),
('2020-12-28', 34, 1001, 'decision', 'Arabic', 81, 'A'),
('2020-12-29', 35, 1002, 'transfer', 'German', 15, 'B'),
('2020-12-30', 36, 1003, 'decision', 'Marathi', 27, 'D'),
('2020-12-31', 37, 1005, 'decision', 'Marathi', 94, 'C'),
('2020-12-31', 38, 1006, 'decision', 'German', 46, 'B'),
('2020-12-31', 39, 1007, 'skip', 'French', 61, 'D'),
('2020-12-31', 11, 1002, 'decision', 'English', 84, 'A'), 
('2020-12-31', 20, 1008, 'transfer', 'Marathi', 61, 'C'),
('2020-12-31', 21, 1009, 'transfer', 'German', 104, 'B'),
('2020-11-01', 22, 1009, 'decision', 'Marathi', 94, 'C'),
('2020-11-02', 23, 1010, 'decision', 'German', 46, 'B'),
('2020-11-03', 24, 1001, 'skip', 'French', 61, 'D'),
('2020-11-04', 25, 1002, 'decision', 'English', 84, 'A'), 
('2020-11-05', 26, 1003, 'transfer', 'Marathi', 61, 'C'),
('2020-11-06', 27, 1004, 'transfer', 'German', 104, 'B'), 
('2020-11-07', 28, 1005, 'decision', 'Marathi', 107, 'A'),
('2020-11-08', 29, 1006, 'decision', 'German', 115, 'B'),
('2020-11-09', 30, 1007, 'skip', 'French', 34, 'C'),
('2020-11-10', 31, 1008, 'decision', 'English', 49, 'D'), 
('2020-11-11', 32, 1009, 'transfer', 'Italian', 85, 'D'),
('2020-11-12', 33, 1010, 'transfer', 'Hindi', 96, 'C'), 
('2020-11-13', 34, 1001, 'decision', 'Marathi', 107, 'A'),
('2020-11-14', 35, 1002, 'decision', 'German', 115, 'B'),
('2020-11-15', 36, 1003, 'skip', 'French', 34, 'C'),
('2020-11-16', 37, 1004, 'decision', 'English', 49, 'D'), 
('2020-11-17', 38, 1005, 'transfer', 'Marathi', 85, 'D'),
('2020-11-18', 39, 1006, 'transfer', 'Hindi', 96, 'C'),
('2020-11-19', 40, 1007, 'decision', 'Marathi', 107, 'A'),
('2020-11-20', 11, 1008, 'decision', 'German', 115, 'B'),
('2020-11-21', 20, 1009, 'skip', 'French', 34, 'C'),
('2020-11-22', 21, 1010, 'decision', 'English', 49, 'D'), 
('2020-11-23', 22, 1001, 'transfer', 'Italian', 85, 'D'),
('2020-11-24', 23, 1002, 'transfer', 'Hindi', 96, 'C');

# Q 1 Number of jobs reviewed
SELECT ROUND(COUNT(DISTINCT job_id) / CAST(30*24 AS decimal(6,3)), 4) AS jobs_per_day
FROM job_data
WHERE ds >= '2020-11-01' AND ds <= '2020-11-30';

# Q 2 Throughput
SELECT ds as date, total_events, AVG(total_events) OVER (ORDER BY ds ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS rolling_avg_7_day
FROM (
    SELECT ds, COUNT(DISTINCT event) AS total_events
    FROM job_data
    WHERE ds >= '2020-11-01' AND ds <= '2020-12-31'
    GROUP BY ds
) sub;

# Q 3 Percentage share of each language
select language, count(language) as total,
count(*)*100/sum(count(*)) over() as percentage 
from job_data
where ds >= '2020-12-01' and ds <= '2020-12-31'
group by language
order by percentage desc;

# Q 4 Duplicate rows
select ds as date, job_id, actor_id, event, language, time_spent, org, count(*) as duplicates
from job_data
group by ds, job_id, actor_id, event, language, time_spent, org
having count(*) > 1;
